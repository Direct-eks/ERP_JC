<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jc.backend.dao.WarehouseStockMapper">

    <resultMap id="WarehouseStockResultMap" type="org.jc.backend.entity.WarehouseStockO">
        <result property="warehouseStockID" column="warehouse_stock_id"/>
        <result property="skuID" column="sku_id"/>
        <result property="warehouseID" column="warehouse_id"/>
        <result property="warehouseName" column="warehouseName"/>
        <result property="stockQuantity" column="stock_quantity"/>
        <result property="stockUnitPriceWithoutTax" column="stock_unit_price_without_tax"/>
        <result property="stockUnitPriceWithTax" column="stock_unit_price_with_tax"/>
        <result property="remark" column="remark"/>
        <result property="storagePlaceID" column="storage_place_id"/>
    </resultMap>


    <select id="queryWarehouseStocksBySku" resultMap="WarehouseStockResultMap">
        select warehouse_stock_id, sku_id, ws.warehouse_id, w.name as warehouseName, stock_quantity,
               stock_unit_price_without_tax, stock_unit_price_with_tax, remark, storage_place_id
        from w_warehouse_stock as ws join w_warehouse as w on ws.warehouse_id = w.warehouse_id
        where ws.sku_id = #{id}
    </select>

    <insert id="insertNewWarehouseStock" useGeneratedKeys="true" keyProperty="warehouseStockID"
            keyColumn="warehouse_stock_id">
        insert into w_warehouse_stock(sku_id, warehouse_id)
        values (#{skuID}, #{warehouseID})
    </insert>

    <select id="queryWarehouseStockByWarehouseAndSku" resultMap="WarehouseStockResultMap">
        select warehouse_stock_id, sku_id, ws.warehouse_id, w.name as warehouseName, stock_quantity,
               stock_unit_price_without_tax, stock_unit_price_with_tax, remark, storage_place_id
        from w_warehouse_stock as ws join w_warehouse as w on ws.warehouse_id = w.warehouse_id
        where ws.sku_id = #{sku} and ws.warehouse_id = #{warehouse}
    </select>

    <select id="queryWarehouseStockByID" resultMap="WarehouseStockResultMap">
        select warehouse_stock_id, sku_id, warehouse_id, stock_quantity, stock_unit_price_without_tax,
               stock_unit_price_with_tax, remark, storage_place_id
        from w_warehouse_stock
        where warehouse_stock_id = #{warehouseStockID}
    </select>


    <update id="increaseStockAndChangeStockUnitPrice">
        update w_warehouse_stock
        set stock_unit_price_without_tax = #{price},
            stock_quantity = #{quantity}
        where warehouse_stock_id = #{id}
    </update>

    <update id="decreaseStock">
        update w_warehouse_stock
        set stock_quantity = #{quantity}
        where warehouse_stock_id = #{id}
    </update>

</mapper>